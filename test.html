<!DOCTYPE html>
 <head>
  <meta charset=UTF-8>
  <title></title>
  <style>
  </style>
 </head>
 <body>
 <div id="messages"></div>

 <script src="class.js"></script>

 <script>
  function msg(str){
   // post the message on the page:
   document.getElementById('messages').innerHTML += str+'<br/>\n';
   // and scroll smoothly to the end:
   window.scroll({top:document.body.scrollHeight, behavior:'smooth'});
  }
 </script>

 <script>

  /*
    The automorphisms
  */

  var valency = 3;
//  var maxdepth = 10;
  var maxdepth = 3;
  // construct a trivial local action for this valency
  var LA = []; for (var n=0;n<valency;n++) LA.push(n);

  var saveT = [];

  for (var depth=1; depth<=maxdepth; depth++){

   var G3 = new Graph('thegraph');
   G3.add_regular_tree(valency,depth);

   var A3 = new Automorphism('aut3',valency);
   A3.set_reference_address([]);
   A3.set_reference_destination([0]);
   A3.add_local_action([],LA);
   A3.set_constant_local_action();

   var t0 = performance.now();
   G3.vertices.map(s=>A3.destination_of_address(s.address));
   var t1 = performance.now();
   saveT.push(t1-t0);
   msg('valency = '+valency+' depth = '+depth+' Naddresses = '+G3.vertices.length+' T = '+(t1-t0)+' ms'+(depth>7?' factor = '+(saveT[saveT.length-1]/saveT[saveT.length-2]).toFixed(2):''));
  }

  // show the destinations on the page
//  G3.alphabet = 'rbg'.split('');
//  G3.vertices.map(s=>msg(s.label()+' -> '+A3.label(A3.address_destinations[s.address],G3)));
  msg('-------------------------------------');
  msg('A3 mappings:')
//  A3.get_addresses_with_destinations().map(s=>msg(A3.label(s,G3)+' -> '+A3.label(A3.address_destinations[s],G3)));
  A3.print_addresses_and_destinations(G3);

  // "list-to-list"-type automorphism:
  var A4 = new Automorphism('aut4',3);
  A4.set_address_destination([],[0]);
  A4.set_address_destination([0],[]);
  A4.set_address_destination([1],[0,1]);
  A4.set_address_destination([2],[0,2]);
  A4.set_address_destination([0,1],[1]);
  A4.set_address_destination([0,2],[2]);
  A4.set_address_destination([1,0],[0,1,0]);
  A4.set_address_destination([1,2],[0,1,2]);

  msg('-------------------------------------');
  msg('compose(A3,A4) mappings: omit undefined final destinations:')
  var A3A4 = compose(A3,A4);
//  A3A4.get_addresses_with_destinations().map(s=>msg(A3A4.label(s,G3)+' -> '+A3A4.label(A3A4.address_destinations[s],G3)));
  A3A4.print_addresses_and_destinations(G3);

  msg('-------------------------------------');
  msg('compose(A3,A4) mappings: include undefined final destinations:')
  var A3A4 = compose(A3,A4,true);
//  A3A4.get_addresses_with_destinations().map(s=>msg(A3A4.label(s,G3)+' -> '+A3A4.label(A3A4.address_destinations[s],G3)));
  A3A4.print_addresses_and_destinations(G3);


  var A2 = new Automorphism('automorphism2');
  A2.valency = 3;
  A2.set_reference_address([0,1]);
  A2.set_reference_destination([0]);
  A2.add_local_action([0,1],[0,1,2]);
  A2.set_constant_local_action();

  // build the look-up table for A2 (ie. A2.address_destinations) using the addresses of vertices in G3
  G3.vertices.map(s=>A2.destination_of_address(s.address));


 </script>
 </body>
</html>
